<!DOCTYPE html>
<html>
<head>
    <title>Setting</title>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes"/>

    <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/cordova-1.8.1.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/NetDroidPlugin.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/ToastPlugin.js"></script>
    <script type="text/javascript" charset="utf-8" src="../js/jquery.mobile-1.1.0.min.js"></script>

    <link type="text/css" href="../css/jquery.mobile-1.1.0.min.css" rel="stylesheet"/>

</head>
<body>
<div id="settingPage" data-role="page" data-theme="b">
    <div data-role="header" data-theme="b" data-position="fixed">
        <h1>Setting Page</h1>
        <a href="index.html" data-role="button" data-icon="home" data-inline="true">Home</a>
        <a href="rule.html" data-role="button" data-transition="flow" data-icon="plus" class="ui-btn-right">Add Rule</a>
    </div>
    <div data-role="content" data-theme="b">
        <ul id="settingList" data-role="listview" data-theme="b" data-divider-theme="d">
        </ul>
    </div>

    <script type="text/javascript">
        $('#settingPage').bind('pageinit', function () {
            var db = window.openDatabase('NetDroid', '1.0', 'NetDroid', 1000000);
            db.transaction(queryDB, errorCB);
        });

        function queryDB(tx) {
            tx.executeSql('select 1 from sqlite_master where type="table" and name="NetDroidRules"',
                    [], function (tx, results) {
                        if (!results || results.rows.length == 0)return;
                        tx.executeSql('select * from NetDroidRules where status=1 order by sortOrder', [], readRules, errorCB);
                    }, errorCB);
        }

        function readRules(tx, results) {
            if (!results || results.rows.length == 0)return;
            var $settingList = $('#settingList');
            for (var i = 0, j = results.rows.length; i < j; i++) {
                var entry = results.rows.item(i),
                        appendHtml = '<li data-role="list-divider">' + entry.ssidName + '<span class="ui-li-count">Current</span></li><li><p>ip:<strong>' + entry.ip + '</strong></p>' +
                                '<p>netmask:<strong>' + entry.netmask + '</strong></p><p>gateway:<strong>' +
                                entry.gateway + '</strong></p><p>dns1:<strong>' + entry.dns1 + '</strong></p>' +
                                '<p>dns2:<strong>' + entry.dns2 + '</strong></p></li>';
                $settingList.append(appendHtml);
            }
            $settingList.listview('refresh');
        }

        function errorCB(t, err) {
            alert("Error processing SQL code: " + err.code + ', message:' + err.message);
        }
    </script>
</div>
</body>
</html>